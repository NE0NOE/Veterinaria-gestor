- name: Deploy to EC2
        run: |
          ssh ${{ secrets.EC2_USER }}@${{ secrets.EC2_HOST }} << 'EOF'
            # Navega a la carpeta del proyecto
            cd ${{ secrets.PROJECT_PATH }}
            echo "âœ… NaveguÃ© a $(pwd)"

            # Descarga los Ãºltimos cambios
            git pull origin main
            echo "âœ… CÃ³digo actualizado desde GitHub."

            # Instala/actualiza las dependencias
            npm install
            echo "âœ… Dependencias instaladas."

            # Compila la aplicaciÃ³n para producciÃ³n
            npm run build
            echo "âœ… Proyecto compilado con 'npm run build'."

            # 'restart' es robusto: si la app estÃ¡ corriendo, la recarga;
            # si se detuvo o dio error, la inicia de nuevo con el comando original.
            pm2 restart veterinaria-app
            echo "âœ… AplicaciÃ³n reiniciada con PM2."
            
            echo "ðŸš€ Despliegue completado."
          EOF